name = "snipe-onchainweb"
main = "workers/index.js"
compatibility_date = "2026-01-30"
# Account ID should be set via environment variable or wrangler secret
# Set via: wrangler secret put CLOUDFLARE_ACCOUNT_ID
account_id = "eb568c24da7c746c95353226eb665d00"

# Node.js compatibility flag for modern Node.js APIs
# See: https://developers.cloudflare.com/workers/runtime-apis/nodejs
compatibility_flags = ["nodejs_compat"]

# Development mode - deploy to *.workers.dev subdomain
# Set to false for production with custom routes
workers_dev = true

[[kv_namespaces]]
binding = "CACHE"
# KV Namespace ID - should be created via wrangler kv:namespace create
id = "488840361a874877b2b54506b15f746a"
preview_id = "488840361a874877b2b54506b15f746a"

[[r2_buckets]]
binding = "STORAGE"
# R2 Bucket - should be created via wrangler r2 bucket create
bucket_name = "onchainweb"
preview_bucket_name = "onchainweb"

[vars]
# Non-sensitive configuration variables
FIREBASE_PROJECT_ID = "onchainweb-b4b36"
FIREBASE_DATABASE_URL = "https://onchainweb-b4b36-default-rtdb.asia-southeast1.firebasedatabase.app"
# SECURITY NOTE: Sensitive tokens should be set via wrangler secrets:
# wrangler secret put TELEGRAM_BOT_TOKEN
# wrangler secret put FIREBASE_PRIVATE_KEY
# For now, placeholder values - REPLACE WITH SECRETS IN PRODUCTION
TELEGRAM_BOT_TOKEN = "SET_VIA_WRANGLER_SECRET"
TELEGRAM_USERNAME = "goblin_niko4"
# R2 public URL - set to your custom domain or R2 public URL
R2_PUBLIC_URL = "https://storage.onchainweb.app"
# Allowed CORS origins (comma-separated)
ALLOWED_ORIGINS = "https://onchainweb.pages.dev,https://www.onchainweb.app"

[build]
command = "npm install && npm run build"

# ============================================
# Staging Environment
# ============================================
[env.staging]
name = "snipe-onchainweb-staging"
workers_dev = true
vars = { ENVIRONMENT = "staging", DEBUG = "true" }

# Staging-specific KV namespace
[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "staging_cache_namespace_id"  # Create with: wrangler kv:namespace create "CACHE" --env staging
preview_id = "staging_cache_namespace_id"

# Staging-specific R2 bucket
[[env.staging.r2_buckets]]
binding = "STORAGE"
bucket_name = "onchainweb-staging"
preview_bucket_name = "onchainweb-staging"

# ============================================
# Production Environment
# ============================================
[env.production]
name = "snipe-onchainweb-production"
workers_dev = false  # Disable *.workers.dev in production
vars = { ENVIRONMENT = "production", DEBUG = "false" }

# Production-specific KV namespace
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "488840361a874877b2b54506b15f746a"
preview_id = "488840361a874877b2b54506b15f746a"

# Production-specific R2 bucket
[[env.production.r2_buckets]]
binding = "STORAGE"
bucket_name = "onchainweb"
preview_bucket_name = "onchainweb"

# Production routes - uncomment and configure for custom domain
# routes = [
#   { pattern = "api.onchainweb.app/*", custom_domain = true }
# ]

# Cloudflare Pages configuration
pages_build_output_dir = "Onchainweb/dist"

# D1 Database binding (legacy - kept for compatibility)
[[d1_databases]]
binding = "DB"
database_name = "onchainweb"
database_id = "e3f277bd-092a-41d6-a477-4521200c79fe"

# ============================================
# Observability & Monitoring
# ============================================
[observability]
enabled = true
head_sampling_rate = 1.0

[observability.logs]
enabled = true
head_sampling_rate = 1.0
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1.0

# ============================================
# Routes Configuration (for production custom domains)
# ============================================
# Uncomment and configure for custom domain routing
# routes = [
#   { pattern = "api.onchainweb.app/*", custom_domain = true },
#   { pattern = "onchainweb.app/api/*", zone_name = "onchainweb.app" }
# ]
#
# For multiple domains:
# routes = [
#   { pattern = "api.domain1.com/*", zone_name = "domain1.com" },
#   { pattern = "api.domain2.com/*", zone_name = "domain2.com" }
# ]
